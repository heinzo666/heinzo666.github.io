<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Visual Output Viewer</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    .group {
      margin-bottom: 80px;
    }
    .images {
      display: flex;
      flex-wrap: wrap;
      gap: 40px;
      align-items: flex-start;
    }
    .pair {
      display: flex;
      gap: 40px;
      align-items: center;
      margin-bottom: 40px;
    }
    .hover-wrap {
      position: relative;
      width: 256px;
      height: 256px;
    }
    .hover-wrap img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: opacity 0.3s ease-in-out;
    }
    .hover-wrap img.mask {
      opacity: 0;
    }
    .hover-wrap:hover img.mask {
      opacity: 1;
    }
  </style>
</head>
<body>
  <h1>Grouped Image Viewer</h1>
  <div id="container"></div>

  <script>
    fetch('filelist.json')
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById('container');

        for (const [group, files] of Object.entries(data)) {
          const div = document.createElement('div');
          div.className = 'group';
          div.innerHTML = `<h2>Group: ${group}</h2>`;

          const imagePairs = [];

          files.initmask.forEach((filename) => {
            if (filename.endsWith('I.png')) {
              const prefix = filename.replace('I.png', '');
              const mMatch = files.initmask.find(f => f.startsWith(prefix) && f.endsWith('M.png'));
              if (mMatch) {
                imagePairs.push({ I: filename, M: mMatch });
              }
            }
          });

          const hImages = files.training.filter(f => f.startsWith('H'));

          for (let i = 0; i < Math.max(imagePairs.length, hImages.length); i++) {
            const pairDiv = document.createElement('div');
            pairDiv.className = 'pair';

            // Left (hover I -> M)
            if (imagePairs[i]) {
              const hoverWrap = document.createElement('div');
              hoverWrap.className = 'hover-wrap';

              const iImg = document.createElement('img');
              iImg.src = `https://raw.githubusercontent.com/heinzo666/initmask/main/outputs/${imagePairs[i].I}`;
              const mImg = document.createElement('img');
              mImg.src = `https://raw.githubusercontent.com/heinzo666/initmask/main/outputs/${imagePairs[i].M}`;
              mImg.classList.add('mask');

              hoverWrap.appendChild(iImg);
              hoverWrap.appendChild(mImg);
              pairDiv.appendChild(hoverWrap);
            }

            // Right (H image)
            if (hImages[i]) {
              const hTag = document.createElement('img');
              hTag.src = `https://raw.githubusercontent.com/heinzo666/training/main/outputs/${hImages[i]}`;
              hTag.style.width = '256px';
              hTag.style.height = '256px';
              hTag.style.objectFit = 'contain';
              pairDiv.appendChild(hTag);
            }

            div.appendChild(pairDiv);
          }

          container.appendChild(div);
        }
      });
  </script>
</body>
</html>
