<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grouped Viewer</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    .group {
      margin-bottom: 60px;
    }
    .group-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .image-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      align-items: center;
    }
    .initmask-pair {
      position: relative;
      width: 256px;
      height: 256px;
    }
    .initmask-pair img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: opacity 0.3s ease-in-out;
    }
    .initmask-pair img.mask {
      opacity: 0;
    }
    .initmask-pair:hover img.mask {
      opacity: 1;
    }
    .training-strip {
      display: flex;
      flex-wrap: nowrap;
      gap: 10px;
      overflow-x: auto;
      padding: 10px;
      background: white;
      border: 1px solid #ccc;
    }
    .training-strip img {
      width: 256px;
      height: 256px;
      object-fit: contain;
      border: 1px solid #aaa;
      background: #fff;
    }
  </style>
</head>
<body>
  <h1>Grouped Viewer</h1>
  <div id="container"></div>

  <script>
    fetch('filelist.json')
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById('container');

        for (const [groupKey, group] of Object.entries(data)) {
          const groupDiv = document.createElement('div');
          groupDiv.className = 'group';

          const title = document.createElement('div');
          title.className = 'group-title';
          title.textContent = `Group: ${groupKey}`;
          groupDiv.appendChild(title);

          const initmaskPairs = [];

          group.initmask.forEach((file) => {
            if (file.endsWith('I.png')) {
              const base = file.slice(0, -5); // remove 'I.png'
              const match = group.initmask.find(f => f === `${base}M.png`);
              if (match) {
                initmaskPairs.push([file, match]);
              }
            }
          });

          const initmaskRow = document.createElement('div');
          initmaskRow.className = 'image-row';

          initmaskPairs.forEach(([iFile, mFile]) => {
            const hoverDiv = document.createElement('div');
            hoverDiv.className = 'initmask-pair';

            const imgI = document.createElement('img');
            imgI.src = `https://raw.githubusercontent.com/heinzo666/initmask/main/outputs/${iFile}`;
            const imgM = document.createElement('img');
            imgM.src = `https://raw.githubusercontent.com/heinzo666/initmask/main/outputs/${mFile}`;
            imgM.classList.add('mask');

            hoverDiv.appendChild(imgI);
            hoverDiv.appendChild(imgM);
            initmaskRow.appendChild(hoverDiv);
          });

          groupDiv.appendChild(initmaskRow);

          const trainingRow = document.createElement('div');
          trainingRow.className = 'training-strip';

          group.training.forEach(hFile => {
            const imgH = document.createElement('img');
            imgH.src = `https://raw.githubusercontent.com/heinzo666/training/main/outputs/${hFile}`;
            trainingRow.appendChild(imgH);
          });

          groupDiv.appendChild(trainingRow);
          container.appendChild(groupDiv);
        }
      });
  </script>
</body>
</html>
